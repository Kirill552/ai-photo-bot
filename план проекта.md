# –ü—Ä–æ–µ–∫—Ç ¬´–ù–µ–π—Ä–æ—Ñ–æ—Ç–æ—Å–µ—Å—Å–∏–∏¬ª (–∏—é–ª—å 2025)

## 0. TL;DR

* **–¶–µ–ª—å:** –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∂–µ–Ω—Å–∫–∏—Ö —Ñ–æ—Ç–æ—Å–µ—Å—Å–∏–π (AI‚Äë–ø–æ—Ä—Ç—Ä–µ—Ç—ã) –∑–∞ 7 –¥–Ω–µ–π –Ω–∞ Python –≤ Yandex Cloud, –∏—Å–ø–æ–ª—å–∑—É—è PiAPI –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.
* **–ë—é–¥–∂–µ—Ç:** <\$40 —Å—Ç–∞—Ä—Ç–æ–≤—ã—Ö –∑–∞—Ç—Ä–∞—Ç (–≤—Å—ë –ø–æ–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≥—Ä–∞–Ω—Ç–æ–º Yandex Cloud + pay‚Äëas‚Äëyou‚Äëgo PiAPI).
* **–í—ã—Ö–æ–¥ –Ω–∞ —Ä—ã–Ω–æ–∫:** –ø—Ä–æ–¥–∞—ë–º –ø–∞–∫–µ—Ç—ã 40/100 —Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ Telegram‚Äë–∫–∞–Ω–∞–ª (5 000 —É—á–∞—Å—Ç–Ω–∏—Ü) + LP.

---

## 1. –ê—É–¥–∏—Ç–æ—Ä–∏—è –∏ –æ—Ñ—Ñ–µ—Ä

| –°–µ–≥–º–µ–Ω—Ç           | –ë–æ–ª—å                                                           | –†–µ—à–µ–Ω–∏–µ                                 | –¶–µ–Ω–∞ / —Ü–µ–Ω–Ω–æ—Å—Ç—å                         |
| ----------------- | -------------------------------------------------------------- | --------------------------------------- | --------------------------------------- |
| –î–µ–≤—É—à–∫–∏ 18‚Äë35 –ª–µ—Ç | –ù—É–∂–Ω—ã —Å—Ç–∏–ª—å–Ω—ã–µ —Ñ–æ—Ç–æ –¥–ª—è —Å–æ—Ü—Å–µ—Ç–µ–π, –Ω–æ –¥–æ—Ä–æ–≥–æ –Ω–∞–Ω–∏–º–∞—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∞ | AI‚Äë—Å–µ—Å—Å–∏—è ¬´–∫–∞–∫ Vogue¬ª, 24‚Äë—á. –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å | 40 —Ñ–æ—Ç–æ ‚Äî 1 099 ‚ÇΩ<br>100 —Ñ–æ—Ç–æ ‚Äî 1 799 ‚ÇΩ |

**–£–¢–ü:** ¬´–ó–∞–≥—Ä—É–∑–∏—Ç–µ 10 —Å–µ–ª—Ñ–∏, —á–µ—Ä–µ–∑ —Å—É—Ç–∫–∏ –ø–æ–ª—É—á–∏—Ç–µ –¥–æ 100 —Å—Ç—É–¥–∏–π–Ω—ã—Ö –ø–æ—Ä—Ç—Ä–µ—Ç–æ–≤¬ª.

---

## 2. –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫ (Assistant + PiAPI Flux)

| –ó–∞–¥–∞—á–∞                          | –°–µ—Ä–≤–∏—Å                                                                                | –¶–µ–Ω–∞\*                                                       |                                                        |                                |      |
| ------------------------------- | ------------------------------------------------------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------ | ------------------------------ | ---- |
|                                 | **–î–∏–∞–ª–æ–≥, –±—Ä–∏—Ñ, –ª–æ–≥–∏–∫–∞**                                                              | **OpenAI Assistants API (GPT‚Äë4o‚Äëmini)** —á–µ—Ä–µ–∑ Webdock‚Äë–ø—Ä–æ–∫—Å–∏ | \$0.15 / M in + \$0.60 / M out —Ç–æ–∫. ‚Üí \$0.00024 / –±—Ä–∏—Ñ |                                |      |
| **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Ä—Ç—Ä–µ—Ç–æ–≤ (–≤—ã–±–æ—Ä)** | **PiAPI ‚Üí Flux‚Äëschnell + LoRA** **–∏–ª–∏** **PiAPI ‚Üí GPT‚Äë4o‚Äëimage** (–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –≤—ã–±–∏—Ä–∞–µ—Ç) | \$0.002 ‚Äî \$0.02 / –∏–∑–æ–±—Ä.                                    |                                                        |                                |      |
| –•–æ—Å—Ç–∏–Ω–≥ –±–æ—Ç–∞ + –ø—Ä–æ–∫—Å–∏           | **Webdock NVMe Nano VPS** (1 vCPU, 1 GB)                                              | \$2.15 / –º–µ—Å                                                 |                                                        |                                |      |
| –•—Ä–∞–Ω–µ–Ω–∏–µ –∏ CDN                  | **Yandex Object Storage + CDN**                                                       | 100 GB –∏—Å—Ö–æ–¥—è—â–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞ **free**, \$0.016/GB‚Äëmo            |                                                        |                                |      |
| –û—á–µ—Ä–µ–¥–∏ / Triggers              | **Yandex Functions + Message Queue**                                                  | 1 –º–ª–Ω –≤—ã–∑–æ–≤–æ–≤ / –º–µ—Å free                                     |                                                        |                                |      |
| CI/CD                           | GitHub Actions –∏–ª–∏ `deploy.sh`                                                        | free                                                         |                                                        | GitHub Actions –∏–ª–∏ `deploy.sh` | free |

\* —Ü–µ–Ω—ã –±–µ–∑ –ù–î–°; –∏—é–ª—å 2025.

---

## 3. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–≥–∏–±—Ä–∏–¥ Assistants + Flux)

```
User (Telegram) ‚îÄ‚ñ∂ aiogram Bot (Webdock) ‚îÄ‚ñ∂ OpenAI Assistants
      ‚îÇ                                  ‚îÇ  ‚îî‚îÄ(tool: collect_brief)
      ‚îÇ                                  ‚îî‚îÄ‚ñ∂ PiAPI Flux (txt2img‚Äëlora)
      ‚îÇ                                         ‚îÇ
      ‚îÇ                                  images (S3 bucket, YC)
      ‚ñº                                         ‚îÇ
Telegram album ‚óÄ‚îÄ‚îÄ delivery_fn (YC Function) ‚óÄ‚îÄ‚îÄ‚îò
```

* **–ë–æ—Ç –Ω–∞ Webdock**: –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ thread Assistants; –ª–æ–≤–∏—Ç `tool_calls`.
* –ü–æ—Å–ª–µ `collect_brief` ‚Üí –∫–ª–∞–¥—ë—Ç –∑–∞–¥–∞—á—É –≤ **YC MQ**.
* **Celery‚Äëworker** –≤ Webdock –∏–ª–∏ YC Container –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç prompts –∏ –≤—ã–∑—ã–≤–∞–µ—Ç Flux API.
* –ì–æ—Ç–æ–≤—ã–µ JPEG –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ **YC Object Storage**, –∞ —Å—Å—ã–ª–∫–∞/–∞–ª—å–±–æ–º –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∫–ª–∏–µ–Ω—Ç–∫–µ.
  . –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
[Client (TG Bot / Web)] ‚Üí HTTPS ‚Üí [FastAPI container]
                                   ‚îÇ
                                   ‚îú‚îÄ‚ñ∂ /generate/  ‚Üí PiAPI call ‚Üí image URLs
                                   ‚îÇ
                                   ‚îî‚îÄ‚ñ∂ /status/    ‚Üí DynamoDoc (YC Managed Mongo) ‚Üê async worker (Celery + YC MQ)
                                          ‚îÇ
                                          ‚îî‚îÄ‚ñ∂ Object Storage (bucket per session)
```

* **TG‚Äë–±–æ—Ç** (aiogram) —Å–æ–±–∏—Ä–∞–µ—Ç —Ñ–æ—Ç–æ, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–π bucket.
* FastAPI —ç–Ω–¥–ø–æ–∏–Ω—Ç –∫–ª–∞–¥—ë—Ç job –≤ –æ—á–µ—Ä–µ–¥—å; –≤–æ—Ä–∫–µ—Ä —Ä–µ–Ω–¥–µ—Ä–∏—Ç batch (–ø–æ 8 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ √ó5 –∫–≤–∞–¥—Ä–∞—Ç–æ–≤) ‚Üí –∞–ø–ª–æ–∞–¥ –≤ bucket.
* –ü–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –±–æ—Ç –ø—É—à–∏—Ç –∞–ª—å–±–æ–º + –ø–ª–∞—Ç—ë–∂–∫—É –Ω–∞ –∞–ø—Å–µ–ª (–≤–∏–¥–µ–æ/LoRA).

---

## 4. Prompt Engineering (–∂–µ–Ω—Å–∫–∏–π –ø–æ—Ä—Ç—Ä–µ—Ç)

```text
/Imagine a cinematic portrait, natural soft light, 85 mm lens bokeh, pastel background,
subject: young woman (age ~25), confident smile, fashion‚Äëeditorial makeup,
trending on instagram, HQ RAW photo, ultra‚Äërealistic, 8k, DOF 1.4 --ar 3:4
```

**–°–æ–≤–µ—Ç—ã:**

1. –°—Ç–∞—Ä–∞–π—Ç–µ—Å—å –Ω–∞ –ø–µ—Ä–≤—ã–π –ø–ª–∞–Ω —Å—Ç–∞–≤–∏—Ç—å ¬´mood + —Å–≤–µ—Ç + —Ç–µ—Ö–Ω–∏–∫–∞¬ª, –∑–∞—Ç–µ–º ¬´subject¬ª.
2. –ò–∑–±–µ–≥–∞–π—Ç–µ —Å–ª–æ–≤ ¬´ai, cartoon, illustration¬ª.
3. –î–ª—è —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω—ã—Ö –ø—Ä–æ–º—Ç–æ–≤ GPT‚Äë4o‚Äëimage –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —á–∏—Ç–∞–µ—Ç –∫–∏—Ä–∏–ª–ª–∏—Ü—É, –ø–æ—ç—Ç–æ–º—É –º–æ–∂–Ω–æ —è–≤–Ω–æ –ø—Ä–æ—Å–∏—Ç—å –Ω–∞–¥–ø–∏—Å–∏.
4. –î–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–π—Ç–µ 3‚Äë5 LoRA —Ç–µ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä ¬´summer‚Äëpastel¬ª, ¬´studio‚Äëbold¬ª).

---

## 5. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è (–¥–µ–Ω—å 1‚Äë7) ‚Äî –≤–µ—Ä—Å–∏—è —Å Assistants

| –î–µ–Ω—å | –≠—Ç–∞–ø                            | –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏                                                                                             |
| ---- | ------------------------------- | ------------------------------------------------------------------------------------------------------------- |
| 1    | **VPS & Docker**                | ‚ë† –ó–∞–∫–∞–∑–∞—Ç—å Webdock Nano; ‚ë° —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Docker & docker‚Äëcompose; ‚ë¢ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–æ–º–µ–Ω + SSL.                       |
| 2    | **Proxy + –ë–æ—Ç**                 | ‚ë† –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å Cursor `proxy.py`, `docker-compose.yml`, `Caddyfile`; ‚ë° –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å ENV —Å `OPENAI_KEY`.       |
| 3    | **Assistant setup**             | ‚ë† –ó–∞–ø—É—Å—Ç–∏—Ç—å `assistant_setup.py` (—Å–æ–∑–¥–∞—Ç—å –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞, —Ñ—É–Ω–∫—Ü–∏—é `collect_brief`); ‚ë° –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±—Ä–∏—Ñ‚Äë–¥–∏–∞–ª–æ–≥. |
| 4    | **Image‚Äëgenerators –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** | ‚ë† –ù–∞–ø–∏—Å–∞—Ç—å `generate_image_flux` (aiohttp call); ‚ë° –≤—ã–±—Ä–∞—Ç—å LoRA `realism`.                                    |
| 5    | **Celery + YC MQ**              | ‚ë† –°–æ–∑–¥–∞—Ç—å –æ—á–µ—Ä–µ–¥—å; ‚ë° –≤–æ—Ä–∫–µ—Ä –≤ Docker‚Äë–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ; ‚ë¢ concurrency = 10.                                          |
| 6    | **Storage & Delivery**          | ‚ë† –°–æ–∑–¥–∞—Ç—å S3‚Äëbucket `ai‚Äëphotos`; ‚ë° `delivery_fn` (YC Function) –¥–ª—è sendMediaGroup/zip.                        |
| 7    | **–¢–µ—Å—Ç‚Äë–∑–∞–ø—É—Å–∫**                 | ‚ë† –°–∏–º—É–ª—è—Ü–∏—è 3 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π; ‚ë° load‚Äëtest 100 –∏–∑–æ–±—Ä.; ‚ë¢ –≤—ã–∫–ª–∞–¥–∫–∞ –ª–µ–Ω–¥–∏–Ω–≥–∞ & –ø–æ—Å—Ç –≤ –≥—Ä—É–ø–ø–µ.                     |

---

## 6. –Æ–Ω–∏—Ç‚Äë—ç–∫–æ–Ω–æ–º–∏–∫–∞ (–¥–∏–∞–ø–∞–∑–æ–Ω)

| –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å                            | 40 —Ñ–æ—Ç–æ             | 100 —Ñ–æ—Ç–æ            |
| ------------------------------------- | ------------------- | ------------------- |
| –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä (Flux \$0.002 / GPT \$0.02) | \$0.08 ‚Äì \$0.80     | \$0.20 ‚Äì \$2.00     |
| Assistants –±—Ä–∏—Ñ                       | \$0.00024           | \$0.00024           |
| –•—Ä–∞–Ω–µ–Ω–∏–µ + —Ç—Ä–∞—Ñ–∏–∫                     | \~0.002             | \~0.005             |
| **–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å**                     | **\$0.09 ‚Äì \$0.88** | **\$0.23 ‚Äì \$2.03** |
| –ü—Ä–æ–¥–∞–∂–Ω–∞—è —Ü–µ–Ω–∞                        | 1 099 ‚ÇΩ             | 1 799 ‚ÇΩ             |
| –ú–∞—Ä–∂–∞                                 | 92 % ‚Äì 99 %         | 80 % ‚Äì 98 %         |

\------------|--------|---------|
\| Flux‚ÄëLoRA \$0.002/–∫–∞–¥—Ä | \$0.08 | \$0.20 |
\| Assistants –±—Ä–∏—Ñ | \$0.00024 | \$0.00024 |
\| –•—Ä–∞–Ω–µ–Ω–∏–µ + —Ç—Ä–∞—Ñ–∏–∫ | \~0.002 | \~0.005 |
\| **–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å** | **\$0.083** | **\$0.205** |
\| –ü—Ä–æ–¥–∞–∂–Ω–∞—è —Ü–µ–Ω–∞ | 1 099 ‚ÇΩ | 1 799 ‚ÇΩ |
\| –ú–∞—Ä–∂–∞ | 97 % | 94 % |

. –Æ–Ω–∏—Ç‚Äë—ç–∫–æ–Ω–æ–º–∏–∫–∞ (–ø—Ä–∏–º–µ—Ä —Å –ø–∞–∫–µ—Ç–æ–º 100 —Ñ–æ—Ç–æ)

| –ú–µ—Ç—Ä–∏–∫–∞                                      | –ó–Ω–∞—á–µ–Ω–∏–µ                       |
| -------------------------------------------- | ------------------------------ |
| –ö–æ–ª‚Äë–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ (12 —Ä–µ–Ω–¥–µ—Ä–æ–≤ √ó \~8 –∫–∞—Ä—Ç–∏–Ω–æ–∫) | 100 –∏–∑–æ–±—Ä.                     |
| –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å PiAPI                          | 100 √ó \$0.02 = **\$2.00**      |
| –î–æ–ø. —Ç—Ä–∞—Ñ–∏–∫ (–≤—ã–¥–∞—á–∞ ‚âà 300 MB)                | <\$0.01 (–≤—Ö–æ–¥–∏—Ç –≤ 100 GB free) |
| –ü—Ä—è–º—ã–µ —Ä–∞—Å—Ö–æ–¥—ã                               | **\$2.01** (‚âà 180 ‚ÇΩ)           |
| –ü—Ä–æ–¥–∞–∂–Ω–∞—è —Ü–µ–Ω–∞                               | **1 799 ‚ÇΩ**                    |
| –ú–∞—Ä–∂–∞                                        | **‚âà 90 %**                     |

–ü–∞–∫–µ—Ç 40 —Ñ–æ—Ç–æ: —Ä–∞—Å—Ö–æ–¥ \$0.80 ‚Üí —Ü–µ–Ω–∞ 1 099 ‚ÇΩ ‚Üí –º–∞—Ä–∂–∞ 93 %.

### –†—ã–Ω–æ—á–Ω—ã–π –±–µ–Ω—á–º–∞—Ä–∫

* ResumePhoto AI ‚Äî 120 —Ñ–æ—Ç–æ –∑–∞ \$34.99 (‚âà 3 166 ‚ÇΩ) ‚Äî 26 ‚ÇΩ/—Ñ–æ—Ç–æ.
* HeadshotPro ‚Äî 40 —Ñ–æ—Ç–æ –∑–∞ \$29 ‚Äî 66 ‚ÇΩ/—Ñ–æ—Ç–æ.
* –í—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º \~18 ‚ÇΩ/—Ñ–æ—Ç–æ (–ø—Ä–∏ –ø–∞–∫–µ—Ç–µ 100) ‚Äî –≤ 3‚Äë4 —Ä–∞–∑–∞ –¥–µ—à–µ–≤–ª–µ —Ä—ã–Ω–∫–∞.

---

## 7. –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥ & –ø—Ä–æ–¥–∞–∂–∏

1. **–ì—Ä—É–ø–ø–∞ 5k:** –ª–æ–Ω–≥—Ä–∏–¥ ¬´–°—Ç—É–¥–∏—è –≤ —Å–º–∞—Ä—Ç—Ñ–æ–Ω–µ¬ª, –∫–æ–Ω—Ç–µ–Ω—Ç‚Äë—Å–µ—Ä–∏–∞–ª –∏–∑ 3 –ø–æ—Å—Ç–æ–≤.
2. **Influencer:** 3 –±–∞—Ä—Ç–µ—Ä‚Äë—Å–µ—Å—Å–∏–∏ (–¥–æ/–ø–æ—Å–ª–µ).
3. **–®–æ—Ä—Ç—Å/–†–∏–ª—Å:** timelapse –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–¥–æ 15 —Å), CTA ‚Üí bot.
4. **Referral:** 15 % –±–æ–Ω—É—Å –∑–∞ –ø–æ–¥—Ä—É–≥—É.

---

## 8. –†–∏—Å–∫–∏ –∏ —é—Ä–∏–¥–∏–∫–∞

* –ö–æ–Ω—Ç–µ–Ω—Ç –ü–æ–ª–∏—Å–∏ PiAPI ‚Äî –∑–∞–ø—Ä–µ—Ç NSFW ‚Üí —Ñ–∏–ª—å—Ç—Ä –ø—Ä–æ–º—Ç–æ–≤.
* –•—Ä–∞–Ω–∏—Ç—å —Å–µ–ª—Ñ–∏ –Ω–µ > 30 –¥–Ω–µ–π (GDPR).
* –ü—É–±–ª–∏—á–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ—Ä—Ç—Ä–µ—Ç–∞ —Ç–æ–ª—å–∫–æ –ø–æ —Å–æ–≥–ª–∞—Å–∏—é.

---

## 9. –°—Å—ã–ª–∫–∏ –∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∏

1. PiAPI Pricing & Docs (07/2025)
2. Yandex Cloud Free Tier (SC/Functions/Object Storage) Docs (06‚Äë07/2025)
3. NYPost AI headshot article (27 –∏—é–Ω 2025)
4. HeadshotPro Pricing page (–º–∞—è 2025)

---

> **Copy‚Äëpaste** —ç—Ç–æ—Ç —Ñ–∞–π–ª –≤ –ª—é–±—É—é IDE/Markdown ‚Äî –æ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–µ—Å—å –ø–ª–∞–Ω, —Ü–µ–Ω—ã, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∏ —à–∞–≥–∏ –∑–∞–ø—É—Å–∫–∞.

## 10. –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –±—Ä–∏—Ñ ‚Äî —Ç–µ–ø–µ—Ä—å —á–µ—Ä–µ–∑ **OpenAI Assistants**

> –ó–∞–º–µ–Ω—è–µ–º —Ä—É—á–Ω–æ–π FSM‚Äë–æ–ø—Ä–æ—Å: –≤—Å—ë –æ–±—â–µ–Ω–∏–µ —Å –∫–ª–∏–µ–Ω—Ç–∫–æ–π –≤–µ–¥—ë—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –Ω–∞ GPT‚Äë4o‚Äëmini. –ë–æ—Ç—É –æ—Å—Ç–∞—ë—Ç—Å—è –ª–∏—à—å –ø–µ—Ä–µ—Å—ã–ª–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è Telegram ‚áÑ Assistants API.

### 10.1 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞

```jsonc
{
  "model": "gpt-4o-mini",
  "tools": [
    {
      "type": "function",
      "function": {
        "name": "collect_brief",
        "description": "–ó–∞–ø–∏—Å–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –±—Ä–∏—Ñ –∫–ª–∏–µ–Ω—Ç–∫–∏ –∏ –≤—ã–±—Ä–∞—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä",
        "parameters": {
          "type": "object",
          "properties": {
            "package": {"type": "integer", "enum": [40,100]},
            "purpose": {"type": "string", "enum": ["insta","avatar","career","dating"]},
            "style": {"type": "string"},
            "background": {"type": "string"},
            "lora_type": {"type": ["string", "null"], "enum": ["realism","mjv6","graphic-portrait",null]},
            "text_overlay": {"type": ["string", "null"]},
            "marketing_consent": {"type": "boolean"},
            "generator": {"type": "string", "enum": ["flux","gpt"]}
          },
          "required": ["package","purpose","style","background","generator"]
        }
      }
    }
  ]
}
```

* **–ü–æ–≤–µ–¥–µ–Ω–∏–µ**: –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –∑–∞–¥–∞—ë—Ç –≤–æ–ø—Ä–æ—Å—ã, –ø–æ–∫–∞ –Ω–µ —Å–º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å `collect_brief`.
* **–Ø–∑—ã–∫**: —Ä—É—Å. (client‚Äëfriendly tone).
* **–ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ**: `max_iterations = 10`, —á—Ç–æ–±—ã –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å ¬´–±–æ–ª—Ç–æ–≤–Ω—é¬ª.

### 10.2 –°—Ü–µ–Ω–∞—Ä–∏–π –±–µ—Å–µ–¥—ã (–ø—Ä–∏–º–µ—Ä)

1. ¬´–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫–æ–π –ø–∞–∫–µ—Ç —Ñ–æ—Ç–æ –≤—ã–±–µ—Ä–µ—Ç–µ ‚Äî 40 –∏–ª–∏ 100?¬ª
2. ¬´–î–ª—è —á–µ–≥–æ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏?¬ª
3. ¬´–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∏–ª—å: Studio Vogue, Pastel Dream‚Ä¶¬ª
4. ¬´–ù–∞ –∫–∞–∫–æ–º —Ñ–æ–Ω–µ –∏—Ö —Å–¥–µ–ª–∞—Ç—å?¬ª
5. ¬´–î–æ–±–∞–≤–ª—è—Ç—å –ª–∏ —Ç–µ–∫—Å—Ç –Ω–∞ —Å–Ω–∏–º–∫–µ?¬ª
6. ¬´–†–∞–∑—Ä–µ—à–∞–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–æ—Ç–æ –≤ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ? –¢–æ–≥–¥–∞ ‚àí10 %¬ª
7. ‚Üí –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –≤—ã–∑—ã–≤–∞–µ—Ç `collect_brief` —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º JSON.

### 10.3 –°—Ç–æ–∏–º–æ—Å—Ç—å –∏ —Ç–∞–π–º–∏–Ω–≥

| –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å           | –ó–Ω–∞—á–µ–Ω–∏–µ                                       |
| -------------------- | ---------------------------------------------- |
| **–°—Ä–µ–¥–Ω–∏–π –¥–∏–∞–ª–æ–≥**   | 600 input + 200 output —Ç–æ–∫–µ–Ω–æ–≤ = 800 —Ç–æ–∫.      |
| **–¶–µ–Ω–∞ GPT‚Äë4o‚Äëmini** | 0.00012 \$ in + 0.00012 \$ out ‚Üí **\$0.00024** |
| **–í—Ä–µ–º—è**            | 2‚Äì3 c/–≤–æ–ø—Ä–æ—Å, –∏—Ç–æ–≥–æ < 30 c.                    |

### 10.4 –ö–∞–∫ –±–æ—Ç —ç—Ç–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç

```python
# handler in aiogram
assistant = OpenAI(assistant_id="asst_photo")
async def tg_to_assistant(msg):
    thread = get_thread(user_id=msg.from_user.id)
    assistant_msg = assistant.chat(thread, content=msg.text)
    for out in assistant_msg:
        if out.tool_calls:
            if out.tool_calls[0].name == "collect_brief":
                save_brief(msg.from_user.id, out.tool_calls[0].arguments)
                mq.publish("brief_ready", session_id)
        else:
            await bot.send_message(msg.chat.id, out.content)
```

–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç —Å–∞–º —Ä–µ—à–∏—Ç, –∫–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, ‚Äî –≤—ã –ª–æ–≤–∏—Ç–µ `collect_brief` –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ –ø–∞–π–ø–ª–∞–π–Ω –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.

### 10.5 –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –ø—Ä–æ—Ç–∏–≤ –ø—Ä–µ–∂–Ω–µ–π –≤–µ—Ä—Å–∏–∏

| –ë—ã–ª–æ (FSM + PiAPI chat)                | –°—Ç–∞–ª–æ (Assistant)                                        |
| -------------------------------------- | -------------------------------------------------------- |
| 7 —à–∞–≥–æ–≤ –≤—Ä—É—á–Ω—É—é –∑–∞–¥–∞–Ω—ã –≤ –∫–æ–¥–µ          | –õ–æ–≥–∏–∫—É –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–∏—à–µ—Ç LLM, –∫–æ–¥ –ª–∏—à—å —Ä–µ—Ç—Ä–∞–Ω—Å–ª–∏—Ä—É–µ—Ç        |
| –í—ã–∑–æ–≤ `chat/completions` PiAPI (‚àí25 %) | –ù–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤; –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –≤—Å—ë –≤ –æ–¥–Ω–æ–º thread |
| –•—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSM                  | –ù–µ –Ω—É–∂–Ω–æ: —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ thread OpenAI                       |

### 10.6 –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è Cursor

> * –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π `assistant_setup.py` ‚Äî —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ —Å —Ñ—É–Ω–∫—Ü–∏–µ–π `collect_brief`.
> * –î–æ–±–∞–≤—å –ø—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ `tg_to_assistant` –≤ `bot/handlers.py`.
> * –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –≤ `.env` –µ—Å—Ç—å `OPENAI_KEY` –∏ `ASSISTANT_ID`.

---

## 11. –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–æ–º—Ç—ã –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∏—Å—Ö–æ–¥–Ω–∏–∫–∞–º

### 11.1 –ë–ª–æ–∫ ¬´–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ¬ª (–æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)

> (SV01 ‚Ä¶ BW06 ‚Äì —Å–º. –ø—Ä–µ–¥—ã–¥—É—â—É—é —Ç–∞–±–ª–∏—Ü—É)

### 11.2 –®–∞–±–ª–æ–Ω—ã –¥–ª—è –Ω–æ–≤—ã—Ö –≤–æ—Å—Ç—Ä–µ–±–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç–∏–ª–µ–π (19.2)

| –ö–æ–¥        | –ü–æ–ª–Ω—ã–π –ø—Ä–æ–º—Ç-—à–∞–±–ª–æ–Ω                                                                                                                                                                                                  |
| ---------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **RL-01**  | `/Imagine a cinematic studio portrait of <<NAME>>, softbox key light, pastel seamless background, gentle color grading, shot on Phase One IQ4 150 MP, ultra‚Äërealistic skin texture, fashion‚Äëeditorial mood --ar 3:4` |
| **FN-02**  | `/Imagine <<NAME>> as ethereal forest fairy, backlit by golden dust particles, pastel haze, flowing chiffon dress, fantasy artbook quality, volumetric lighting, 8k RAW --ar 2:3`                                    |
| **CP-03**  | `/Imagine a cyberpunk portrait of <<NAME>>, neon Tokyo alley, rain-soaked jacket, reflective puddles, teal-magenta color scheme, cinematic DOF, 50 mm f/1.2, ultra‚Äërealistic --ar 3:4`                               |
| **MJ6-04** | `/Imagine an elegant editorial portrait of <<NAME>>, soft rim light, minimal background, Vogue aesthetic, hyper‚Äëdetail --ar 3:4 <lora_type:"mjv6", lora_strength:0.8>`                                               |
| **CEO-05** | `/Imagine a professional corporate headshot of <<NAME>>, charcoal blazer, subtle rim light, dark grey backdrop, Leica SL2‚ÄëS 90 mm Summicron prime lens, impeccable skin retouch, Forbes cover mood --ar 4:5`         |
| **PST-06** | `/Imagine <<NAME>> in pastel dream aesthetic, diffused window light, blooming peonies, mint & blush palette, Fuji Pro400H film simulation, light grain, shallow DOF 1.2, 85 mm lens --ar 2:3`                        |
| **CLS-07** | `/Imagine a timeless black‚Äëand‚Äëwhite portrait of <<NAME>>, high-contrast Rembrandt lighting, medium‚Äëformat Hasselblad, deep shadows, Ilford HP5 film emulation, 6k resolution --ar 1:1`                              |
| **CSP-08** | `/Imagine <<NAME>> as heroic fantasy warrior, ornate armor with glowing runes, dynamic rim light, dramatic atmosphere, concept‚Äëart quality, epic scale --ar 3:4`                                                     |

*–ó–∞–º–µ–Ω–∏—Ç–µ `<<NAME>>` LoRA‚Äë—Ç–æ–∫–µ–Ω–æ–º –∫–ª–∏–µ–Ω—Ç–∞ –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ–º –≤–Ω–µ—à–Ω–æ—Å—Ç–∏. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `<<BG>>`, `<<TEXT>>` –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏, –µ—Å–ª–∏ –Ω—É–∂–Ω—ã.*

### 11.3 –ß–µ–∫‚Äë–ª–∏—Å—Ç –∏—Å—Ö–æ–¥–Ω—ã—Ö —Ñ–æ—Ç–æ ‚Ä¶ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)

–ß–µ–∫‚Äë–ª–∏—Å—Ç –∏—Å—Ö–æ–¥–Ω—ã—Ö —Ñ–æ—Ç–æ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∫–∏

1. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:** 10‚Äì15 —Ñ–æ—Ç–æ (–º–∏–Ω–∏–º—É–º 8) —Å —Ä–∞–∑–Ω—ã–º –æ—Å–≤–µ—â–µ–Ω–∏–µ–º –∏ —É–≥–ª–∞–º–∏.
2. **–ö–∞–¥—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ:**

   * 3 √ó —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –ø–ª–µ—á–µ–≤—ã–µ
   * 2 √ó /4 –ø–æ–≤–æ—Ä–æ—Ç (45¬∞)
   * 1 √ó –ø—Ä–æ—Ñ–∏–ª—å (–ª–µ–≤—ã–π –∏–ª–∏ –ø—Ä–∞–≤—ã–π)
   * 2 √ó –ø–æ–ª—É‚Äë—Ñ–∏–≥—É—Ä–∞ (–¥–æ –ø–æ—è—Å–∞)
   * 1 √ó –ø–æ–ª–Ω—ã–π —Ä–æ—Å—Ç (–ø–æ –∂–µ–ª–∞–Ω–∏—é)
3. **–û—Å–≤–µ—â–µ–Ω–∏–µ:** —Ö–æ—Ç—è –±—ã –ø–æ–ª–æ–≤–∏–Ω–∞ —Å–Ω–∏–º–∫–æ–≤ –ø—Ä–∏ –¥–Ω–µ–≤–Ω–æ–º —Ä–∞—Å—Å–µ—è–Ω–Ω–æ–º —Å–≤–µ—Ç–µ; –∏–∑–±–µ–≥–∞—Ç—å –∂—ë—Å—Ç–∫–∏—Ö —Ç–µ–Ω–µ–π –∏ –ª–∞–º–ø —Å —Ü–≤–µ—Ç–æ–≤–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π < 3000 K.
4. **–ö–∞—á–µ—Å—Ç–≤–æ:** ‚â• 1 024 px –ø–æ —à–∏—Ä–∏–Ω–µ, –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤ Snapchat/Instagram, –±–µ–∑ —á—Ä–µ–∑–º–µ—Ä–Ω–æ–≥–æ HDR/Beauty‚ÄëMode.
5. **–†–µ–∑–∫–æ—Å—Ç—å –ª–∏—Ü–∞:** –≥–ª–∞–∑–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–º–µ—Ç–Ω–æ –≤ —Ñ–æ–∫—É—Å–µ; –∏—Å–∫–ª—é—á–∏—Ç—å —Å–º–∞–∑.
6. **–í—ã—Ä–∞–∂–µ–Ω–∏—è:** –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è —É–ª—ã–±–∫–∞, —Å–µ—Ä—å—ë–∑–Ω–æ–µ –ª–∏—Ü–æ, –ª—ë–≥–∫–∞—è —ç–º–æ—Ü–∏—è ‚Äî –ø–æ 2 –∫–∞–¥—Ä–∞ –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞.
7. **–§–æ–Ω:** –æ–¥–Ω–æ—Ç–æ–Ω–Ω–∞—è —Å—Ç–µ–Ω–∞ –∏–ª–∏ –º—è–≥–∫–∏–π –±—ç–∫–≥—Ä–∞—É–Ω–¥ –±–µ–∑ —è—Ä–∫–∏—Ö –∫–æ–Ω—Ç—Ä–∞—Å—Ç–æ–≤ –∏ –ª–∏—à–Ω–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤ (–∑–µ—Ä–∫–∞–ª–∞, —Ä–∞–º–∫–∏).
8. **–í–æ–ª–æ—Å—ã/–∞–∫—Å–µ—Å—Å—É–∞—Ä—ã:** –ª–∏—Ü–æ –±–µ–∑ –∫—Ä—É–ø–Ω—ã—Ö –ø—Ä—è–¥–µ–π, –±–µ–∑ —Å–æ–ª–Ω—Ü–µ–∑–∞—â–∏—Ç–Ω—ã—Ö –æ—á–∫–æ–≤, –¥–æ–ø—É—Å–∫–∞—é—Ç—Å—è —Ä–∞–∑–Ω—ã–µ –ø—Ä–∏—á—ë—Å–∫–∏ (–¥–æ 3 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤).
9. **–û–¥–µ–∂–¥–∞:** 2‚Äë3 –æ–±—Ä–∞–∑–∞ (casual, –ª—ë–≥–∫–∞—è –∫–ª–∞—Å—Å–∏–∫–∞, —è—Ä–∫–∏–π –∞–∫—Ü–µ–Ω—Ç), –∏–∑–±–µ–≥–∞—Ç—å –º–µ–ª–∫–æ–≥–æ –ø—ë—Å—Ç—Ä–æ–≥–æ —É–∑–æ—Ä–∞.
10. **–§–æ—Ä–º–∞—Ç:** JPEG –∏–ª–∏ HEIC, —Å–∂–∞—Ç—å ‚â§ 3 MB –∫–∞–∂–¥–∞—è.

> –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –±–æ—Ç–µ (–º–æ–¥—É–ª—å `opencv + face_recognition`) ‚Äî –æ—Ç—Å–µ–∫–∞–π—Ç–µ —Ñ–æ—Ç–æ, –≥–¥–µ –ª–∏—Ü–æ < 128 px –∏–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ < 80 % –ª–∏—Ü–∞.

---

**–î–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏:** –¥–æ–±–∞–≤–∏—Ç—å —ç—Ç–∏ –ø—Ä–æ–º—Ç—ã –≤ –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ ¬´—Å—Ç–∏–ª–µ–π¬ª –∏ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —á–µ–∫‚Äë–ª–∏—Å—Ç –≤ —à–∞–≥–µ 2 –±—Ä–∏—Ñ–∞ –≤ –≤–∏–¥–µ –∫–∞—Ä—É—Å–µ–ª–∏ –ø—Ä–∏–º–µ—Ä–æ–≤.

## 12. End‚Äëto‚ÄëEnd Automation Blueprint (Assistant‚ÄëDriven)

| ‚Ññ | –ö–æ–º–ø–æ–Ω–µ–Ω—Ç            | –¢—Ä–∏–≥–≥–µ—Ä                 | –î–µ–π—Å—Ç–≤–∏–µ                                                                        | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è        |
| - | -------------------- | ----------------------- | ------------------------------------------------------------------------------- | ----------------- |
| 1 | **Assistant thread** | –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ         | –≤–µ–¥—ë—Ç –¥–∏–∞–ª–æ–≥, –∑–∞—Ç–µ–º `tool_call: collect_brief` (—Å –ø–æ–ª–µ–º `generator`)            | GPT‚Äë4o‚Äëmini       |
| 2 | **bot_webhook**     | –ø–æ–ª—É—á–µ–Ω `collect_brief` | —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç JSON, –ø—É–±–ª–∏–∫—É–µ—Ç `brief_ready`                                         | aiogram Bot       |
| 3 | **prompt_drafter**  | `brief_ready`           | –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 12 prompts —á–µ—Ä–µ–∑ tool `draft_prompts`                                | Assistants API    |
| 4 | **image_worker**    | prompts + `generator`   | –µ—Å–ª–∏ `flux` ‚Üí Flux txt2img‚Äëlora; –µ—Å–ª–∏ `gpt` ‚Üí GPT‚Äë4o‚Äëimage; –∑–∞–≥—Ä—É–∂–∞–µ—Ç JPEG –≤ S3 | Celery + aiohttp  |
| 5 | **video_worker**    | –°—Ç–∞–Ω–¥–∞—Ä—Ç/–ü—Ä–µ–º–∏—É–º        | WanX img2video –Ω–∞ –ª—É—á—à–µ–º —Ñ–æ—Ç–æ; –∑–∞–≥—Ä—É–∂–∞–µ—Ç MP4 –≤ S3                               | Celery + PiAPI    |
| 6 | **post_proc**       | –ü—Ä–µ–º–∏—É–º                 | face restore, inpaint, 4K upscale                                               | CodeFormer + GPU  |
| 7 | **delivery_fn**     | –≤—Å–µ –≥–æ—Ç–æ–≤–æ              | –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∞–ª—å–±–æ–º + –≤–∏–¥–µ–æ –≤ Telegram                                            | YC Function       |
| 8 | **cleanup_job**     | CRON daily              | —É–¥–∞–ª—è–µ—Ç –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ —Å—Ç–∞—Ä—à–µ 30 –¥–Ω.                                                 | YC Container cron |

*–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø–æ –ø–æ–ª—é `generator` –∏–∑ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞. –î–ª—è –ø–∞–∫–µ—Ç–æ–≤ "–°—Ç–∞–Ω–¥–∞—Ä—Ç" –∏ "–ü—Ä–µ–º–∏—É–º" –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ.*

. –°—Ç—Ä–∞—Ç–µ–≥–∏—è –≤—ã–¥–∞—á–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ Telegram

| –¢–∞—Ä–∏—Ñ                    | –ú–µ—Ç–æ–¥ –¥–æ—Å—Ç–∞–≤–∫–∏                     | –î–µ—Ç–∞–ª–∏                                                                                                                                                                                       |
| ------------------------ | ---------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **40 —Ñ–æ—Ç–æ**              | **–í–∞—Ä–∏–∞–Ω—Ç 3:** –ø—Ä–µ–≤—å—é + CDN‚Äë—Å—Å—ã–ª–∫–∞ | ‚Ä¢ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –±–∞—Ç—á –ø—Ä–µ–≤—å—é (–¥–æ 1280 px) —á–µ—Ä–µ–∑ `sendMediaGroup` (—Ç–∏–ø **photo**).<br>‚Ä¢ –ü–æ–¥ –∫–∞–∂–¥—ã–º –ø—Ä–µ–≤—å—é inline‚Äë–∫–Ω–æ–ø–∫–∞ ¬´üì• –°–∫–∞—á–∞—Ç—å 8K¬ª —Å –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º URL (expiry = 30 –¥–Ω–µ–π).                     |
| **100 —Ñ–æ—Ç–æ / –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ** | **–ê—Ä—Ö–∏–≤ .zip**                     | ‚Ä¢ –°–∫—Ä–∏–ø—Ç —Å–æ–±–∏—Ä–∞–µ—Ç `100.jpg` ‚Üí `zip` < 2 GB.<br>‚Ä¢ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–¥–Ω–∏–º `sendDocument` (Bot API –¥–æ 4 GB) –±–µ–∑ —Å–∂–∞—Ç–∏—è.<br>‚Ä¢ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å —Å `upload_progress_hook` (–ø—Ä–∏–º–µ—Ä: ¬´–ó–∞–≥—Ä—É–∂–∞—é 3/10‚Ä¶¬ª). |

### 13.1 Telegram‚Äë–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

* **50 —Ñ–∞–π–ª–æ–≤** –≤ –æ–¥–Ω–æ–º `sendMediaGroup`; –¥–ª—è 100 —Ñ–æ—Ç–æ –¥–µ–ª–∏–º –Ω–∞ **2 –±–∞—Ç—á–∞** –ø–æ 50 –ø—Ä–µ–≤—å—é.
* –§–∞–π–ª—ã –¥–æ 20 MB –≥—Ä—É–∑—è—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ; –µ—Å–ª–∏ –ø—Ä–µ–≤—å—é > 5 MB, –¥–µ–ª–∞–π—Ç–µ `jpegoptim` –¥–æ ‚âà2 MB –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π.
* –ü–æ–¥–ø–∏—Å—å CDN‚ÄëURL –≤ **Yandex Object Storage** –Ω–∞ 30 –¥–Ω–µ–π ‚Üí nightly cron‚Äëcleaner —É–¥–∞–ª—è–µ—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –æ–±—ä–µ–∫—Ç—ã, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –≤ free‚Äëtier.

### 13.2 –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –¥–ª—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

```python
async def progress(current, total):
    pct = int(current / total * 100)
    if pct % 10 == 0:
        await bot.edit_message_text(chat_id, msg_id,
            text=f"üîÑ –ó–∞–≥—Ä—É–∂–∞—é‚Ä¶ {pct}%")

await bot.send_document(chat_id, InputFile(zip_path),
                        caption="–í–∞—à –∞–ª—å–±–æ–º 100 —Ñ–æ—Ç–æ üíé",
                        disable_content_type_detection=True,
                        progress=progress)
```

> –≠—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç –∫–ª–∏–µ–Ω—Ç—É –∫–æ–º—Ñ–æ—Ä—Ç (–ø—Ä–µ–≤—å—é –±—ã—Å—Ç—Ä–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –æ—Ä–∏–≥–∏–Ω–∞–ª—ã –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ —Å—Å—ã–ª–∫–µ/–≤ –∞—Ä—Ö–∏–≤–µ) –∏ –≤–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –ª–∏–º–∏—Ç—ã Telegram –∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç—Ä–∞—Ñ–∏–∫ Yandex Cloud.

## 14. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞—É–¥–∏—Ç & –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)

| Var                | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                         | –ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—å                   |
| ------------------ | -------------------------------------------------- | ----------------------------- |
| `OPENAI_KEY`       | –∫–ª—é—á OpenAI Assistants                             | Webdock `.env`, GitHub Secret |
| `PIAPI_KEY`        | –∫–ª—é—á PiAPI (–∏–∑–æ–±—Ä.)                                | YC Functions Secret           |
| `YC_OBJECT_BUCKET` | S3 bucket name                                     | env                           |
| `BOT_TOKEN`        | Telegram bot                                       | env                           |
| `WEBDOCK_URL`      | [https://api.photobot.ai](https://api.photobot.ai) | Caddyfile                     |

*–õ–∏–º–∏—Ç—ã*: Assistants ‚Äî 10 RPS/thread; Flux‚Äëschnell ‚Äî 15 RPS API‚Äë–∞–∫–∫–∞—É–Ω—Ç.

*–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ*:

```
/.github/workflows/deploy.yml
/proxy/
/src/
  bot/
  worker/
assistant_setup.py
```

### Docker

* `bot` –∏ `worker` –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–∞ Webdock; `delivery_fn` ‚Äî YC Function (Python 3.11 runtime).

. Webdock —Å–µ—Ä–≤–µ—Ä –∫–∞–∫ –ø—Ä–æ–∫—Å–∏‚Äë—É–∑–µ–ª OpenAI

### 15.1 –ö–æ–Ω—Ç–µ–∫—Å—Ç

* –£–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç VPS **webdock‚Äënano** (–ø—Ä–æ–µ–∫—Ç—ã ¬´–Ω–µ–π—Ä–æ–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è¬ª).<br>–†–µ—Å—É—Ä—Å—ã —Å–≤–æ–±–æ–¥–Ω—ã: \~550 MB RAM, \~12 GB SSD.
* –ó–∞–¥–∞—á–∞ ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –ª—ë–≥–∫–∏–π FastAPI‚Äë–ø—Ä–æ–∫—Å–∏ –∫ `api.openai.com` –∏ –Ω–µ –ø–æ–∫—É–ø–∞—Ç—å –Ω–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä.

### 15.2 –®–∞–≥–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–¥–æ–±–∞–≤—å –≤ README –ø—Ä–æ–µ–∫—Ç–∞)

1. **SSH –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø–∞–∫–µ—Ç—ã**

   ```bash
   # –µ—Å–ª–∏ Docker –µ—â—ë –Ω–µ —Å—Ç–æ–∏—Ç
   curl -sSL https://get.docker.com | sh
   apt install docker-compose-plugin -y
   ```
2. **DNS + SSL**

   * A‚Äë–∑–∞–ø–∏—Å—å: `api.photobot.ai ‚ûù <VPS IP>`
   * Webdock ‚Üí Domains & SSL ‚Üí Let's Encrypt –¥–ª—è –ø–æ–¥–¥–æ–º–µ–Ω–∞.
3. **–§–∞–π–ª—ã –≤ /opt/ai‚Äëstudio**

   ```
   docker-compose.yml
   Caddyfile
   proxy/
     ‚îú‚îÄ Dockerfile
     ‚îî‚îÄ proxy.py
   ```
4. **docker-compose.yml** (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)

   ```yaml
   services:
     openai-proxy:
       build: ./proxy
       env_file: .env
       mem_limit: "256m"
       networks: [ backend ]

     travelbot:        # —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Å–µ—Ä–≤–∏—Å
       image: ghcr.io/you/travelbot:latest
       networks: [ backend ]

     web:
       image: caddy:2
       volumes:
         - ./Caddyfile:/etc/caddy/Caddyfile:ro
       ports: [ "80:80", "443:443" ]
       networks: [ backend ]

   networks:
     backend:
       driver: bridge
   ```
5. **proxy/Dockerfile**

   ```dockerfile
   FROM python:3.11-slim
   RUN pip install fastapi[all] aiohttp uvicorn
   COPY proxy.py /app/
   CMD ["uvicorn", "proxy:app", "--host", "0.0.0.0", "--port", "8000"]
   ```
6. **proxy.py**

   > –í Cursor —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π FastAPI‚Äërelay —Å rate‚Äëlimit RPS = 15 –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `OPENAI_KEY`.
7. **Caddyfile**

   ```
   api.photobot.ai {
       reverse_proxy openai-proxy:8000
   }

   travel.example.com {
       reverse_proxy travelbot:8080
   }
   ```
8. **ENV‚Äë–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (.env)**

   ```dotenv
   OPENAI_KEY=sk-....
   RATE_LIMIT_RPS=15
   ```
9. **–ó–∞–ø—É—Å–∫**

   ```bash
   cd /opt/ai-studio
   docker compose up -d --build
   ```
10. **–ü—Ä–æ–≤–µ—Ä–∫–∞**

    ```bash
    curl https://api.photobot.ai/v1/models
    ```

    ‚Üí —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π OpenAI.

---

## 16. –ú–∏–Ω–∏‚ÄëCI/CD –±–µ–∑ GitHub Actions (–æ–ø—Ü–∏—è)

> –ü–æ–∫–∞ –≤—ã –ø—Ä–∏–≤—ã–∫–ª–∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–∞–π–ª—ã –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ Terminus, –¥–æ–±–∞–≤—å—Ç–µ bash‚Äë—Å–∫—Ä–∏–ø—Ç **deploy.sh** –∏ –ø—É—Å—Ç—å Cursor –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –µ–≥–æ.

```bash
#!/bin/bash
set -e
scp -r * root@<VPS_IP>:/opt/ai-studio/
ssh root@<VPS_IP> "cd /opt/ai-studio && docker compose pull && docker compose up -d --build"
```

1. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç–µ `deploy.sh` –≤ –∫–æ—Ä–Ω–µ —Ä–µ–ø–æ.
2. –ù–∞ —Å–≤–æ—ë–º –ü–ö: `bash deploy.sh` ‚Äî –≤–µ—Å—å –ø—Ä–æ–µ–∫—Ç –∑–∞–ª–∏–≤–∞–µ—Ç—Å—è –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è.

### –ö–∞–∫ –ø–µ—Ä–µ–π—Ç–∏ –∫ GitHub Actions –ø–æ–∑–∂–µ

1. –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ –∑–∞–ø—É—à—å—Ç–µ –ø—Ä–æ–µ–∫—Ç.
2. –í Settings‚ÜíSecrets –¥–æ–±–∞–≤—å—Ç–µ:

   * `WEBDOCK_IP`, `WEBDOCK_KEY` (SSH private‚Äëkey), `GHCR_TOKEN`.
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ workflow –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ 14.5 –∏ –∞–¥–∞–ø—Ç–∏—Ä—É–π—Ç–µ `services:`.

---

> **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è Cursor‚ÄëAI**
>
> 1. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π —Ñ–∞–π–ª—ã `docker-compose.yml`, `proxy/Dockerfile`, `proxy/proxy.py`, `Caddyfile`, `deploy.sh` –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é –≤—ã—à–µ.
> 2. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ–±—ã `mem_limit`, `ports` –∏ `env_file` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ –ø—É–Ω–∫—Ç—É 15.2.
> 3. –í—ã–≤–µ–¥–∏ –∫–æ–º–∞–Ω–¥—É –ø—Ä–æ–≤–µ—Ä–∫–∏ `curl`.

–¢–µ–ø–µ—Ä—å –ø–ª–∞–Ω –æ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –≥–∏–±—Ä–∏–¥–Ω—É—é —Å—Ö–µ–º—É: –Ø–Ω–¥–µ–∫—Å Cloud –æ—Å—Ç–∞—ë—Ç—Å—è —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º –∏ –æ—á–µ—Ä–µ–¥—è–º–∏, Webdock –≤–º–µ—Å—Ç–∏–ª –ø—Ä–æ–∫—Å–∏ –∏ –≤—Ç–æ—Ä–æ–π –±—ã—Å—Ç—Ä—ã–π –±–æ—Ç –±–µ–∑ –ø–æ–∫—É–ø–∫–∏ –Ω–æ–≤–æ–≥–æ VPS.

## 17. Yandex Object Storage ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –±–∞–∫–µ—Ç–∞, —Ä–æ–ª–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (step‚Äëby‚Äëstep)

> –°—Å—ã–ª–∫–∏ –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –¥–æ–∫–∏: —Å–æ–∑–¥–∞–Ω–∏–µ –±–∞–∫–µ—Ç–∞ ([yandex.cloud](https://yandex.cloud/en/docs/storage/operations/buckets/create?utm_source=chatgpt.com)), —Ä–æ–ª–∏ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ ([yandex.cloud](https://yandex.cloud/ru/docs/storage/s3/?utm_source=chatgpt.com)), —Ü–µ–Ω–æ–≤–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ –∏ free‚Äëtier ([yandex.cloud](https://yandex.cloud/en/docs/storage/pricing?utm_source=chatgpt.com)).

### 17.1 –ú–∏–Ω–∏‚Äë–≥–ª–æ—Å—Å–∞—Ä–∏–π

| –¢–µ—Ä–º–∏–Ω                     | –ß—Ç–æ –∑–Ω–∞—á–∏—Ç                                                           |
| -------------------------- | -------------------------------------------------------------------- |
| **–û–±–ª–∞–∫–æ / –∫–∞—Ç–∞–ª–æ–≥**       | ¬´–ü–∞–ø–∫–∞¬ª —Ä–µ—Å—É—Ä—Å–æ–≤ YC. –í—Å–µ –ø—Ä–∞–≤–∞ –Ω–∞–∑–Ω–∞—á–∞—é—Ç—Å—è –Ω–∞ –æ–±–ª–∞–∫–æ/–∫–∞—Ç–∞–ª–æ–≥/—Ä–µ—Å—É—Ä—Å. |
| **–ë–∞–∫–µ—Ç (bucket)**         | –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ñ–∞–π–ª–æ–≤ –≤ Object Storage (–∞–Ω–∞–ª–æ–≥ S3‚Äëbucket).                |
| **–°–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç (SA)** | ¬´–†–æ–±–æ—Ç¬ª —Å –∫–ª—é—á–∞–º–∏, –æ—Ç –∏–º–µ–Ω–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ –≤–∞—à –∫–æ–¥ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ API.       |
| **Role**                   | –ù–∞–±–æ—Ä —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π (`storage.editor`, `storage.uploader`, ‚Ä¶).          |

### 17.2 –ö–∞–∫–∏–µ —Ä–æ–ª–∏ –Ω—É–∂–Ω—ã

| –¶–µ–ª—å                              | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–æ–ª—å –Ω–∞ –∫–∞—Ç–∞–ª–æ–≥ (–∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –±–∞–∫–µ—Ç)                                          |
| --------------------------------- | ------------------------------------------------------------------------------------------- |
| –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –±–∞–∫–µ—Ç–æ–≤       | `storage.editor`                                                                            |
| –ó–∞–≥—Ä—É–∑–∫–∞/—á—Ç–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ | `storage.editor` (–∏–ª–∏ `storage.uploader` + `storage.viewer` –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∑–∞–ø—Ä–µ—Ç–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ) |
| –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ACL/–ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞  | `storage.admin` (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, –µ—Å–ª–∏ –±–∞–∫–µ—Ç—ã –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∏ —Å—Å—ã–ª–∫–∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞—é—Ç—Å—è)                |

> **–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ:** –¥–∞—Ç—å SA —Ä–æ–ª—å **`storage.editor`** –Ω–∞ –∫–∞—Ç–∞–ª–æ–≥, –≥–¥–µ –ª–µ–∂–∏—Ç –±–∞–∫–µ—Ç ‚Äî –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –Ω–∞—à–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∏ –Ω–µ –¥–∞—ë—Ç –ª–∏—à–Ω–∏—Ö –∞–¥–º–∏–Ω‚Äë–ø—Ä–∞–≤.

### 17.3 –®–∞–≥‚Äë–∑–∞‚Äë—à–∞–≥–æ–º (–∫–æ–Ω—Å–æ–ª—å + CLI)

#### –®–∞–≥ 0. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

* –õ–æ–≥–∏–Ω –≤ –∫–æ–Ω—Å–æ–ª—å [cloud.yandex.ru].
* –í—ã–±–µ—Ä–∏—Ç–µ **–û–±–ª–∞–∫–æ ‚Üí –ö–∞—Ç–∞–ª–æ–≥** (–Ω–∞–ø—Ä–∏–º–µ—Ä *photo‚Äëstudio*).

#### –®–∞–≥ 1. –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç

> *–í –∫–æ–Ω—Å–æ–ª–∏*

1. –ú–µ–Ω—é **IAM & Auth ‚Üí –°–µ—Ä–≤–∏—Å–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã ‚Üí –°–æ–∑–¥–∞—Ç—å**.
2. –ò–º—è: `photo‚Äëbot‚Äësa`.
3. –ù–∞–∂–º–∏—Ç–µ ¬´–°–æ–∑–¥–∞—Ç—å¬ª.

> *–ò–ª–∏ –≤ CLI*

```bash
yc iam service-account create --name photo-bot-sa --folder-id $FOLDER_ID
SA_ID=$(yc iam service-account get photo-bot-sa --format json | jq -r .id)
```

#### –®–∞–≥ 2. –ù–∞–∑–Ω–∞—á–∏—Ç—å —Ä–æ–ª—å `storage.editor`

```bash
yc resource-manager folder add-access-binding $FOLDER_ID \
  --role storage.editor \
  --subject serviceAccount:$SA_ID
```

*(–ï—Å–ª–∏ –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ YC Functions/Containers, –¥–æ–±–∞–≤—å—Ç–µ —Ç–∞–∫–∂–µ —Ä–æ–ª—å `iam.serviceAccounts.user` –Ω–∞ —Ç—É —Ñ—É–Ω–∫—Ü–∏—é, —á—Ç–æ–±—ã –æ–Ω–∞ –º–æ–≥–ª–∞ ¬´–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å¬ª SA.)*

#### –®–∞–≥ 3. –í—ã–ø–∏—Å–∞—Ç—å –∫–ª—é—á –¥–æ—Å—Ç—É–ø–∞ (S3‚Äëcompatible)

```bash
yc iam access-key create --service-account-id $SA_ID --description "S3 key for photobot"
```

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ `access_key_id` –∏ `secret` ‚Üí –≤ `.env` (`AWS_ACCESS_KEY_ID`, `AWS_SECRET_ACCESS_KEY`).

#### –®–∞–≥ 4. –°–æ–∑–¥–∞—Ç—å –±–∞–∫–µ—Ç

*–ß–µ—Ä–µ–∑ –≤–µ–±‚Äë–∫–æ–Ω—Å–æ–ª—å*

1. –û—Ç–∫—Ä–æ–π—Ç–µ **Object Storage ‚Üí –°–æ–∑–¥–∞—Ç—å –±–∞–∫–µ—Ç**.
2. –ò–º—è: `ai-photos` (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –≥–ª–æ–±–∞–ª—å–Ω–æ).
3. –†–µ–≥–∏–æ–Ω: **ru-central1**.
4. –ö–ª–∞—Å—Å —Ö—Ä–∞–Ω–µ–Ω–∏—è: **Standard (–ø–æ —É–º–æ–ª—á.)**.
5. –†–∞–∑–º–µ—Ä –±–∞–∫–µ—Ç–∞: –º–æ–∂–Ω–æ –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å.
6. –ù–∞–∂–º–∏—Ç–µ ¬´–°–æ–∑–¥–∞—Ç—å¬ª.

*CLI‚Äë–≤–∞—Ä–∏–∞–Ω—Ç*

```bash
yc storage bucket create --name ai-photos --folder-id $FOLDER_ID --max-size 20G --storage-class standard
```

‚Äî –ü–µ—Ä–≤–∞—è 1 GB –∏ 100 000 GET/HEAD/OPTIONS –≤ –º–µ—Å—è—Ü –±–µ—Å–ø–ª–∞—Ç–Ω–æ ([yandex.cloud](https://yandex.cloud/en/docs/storage/pricing?utm_source=chatgpt.com)).

#### –®–∞–≥ 5. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CORS (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ CDN –Ω–∞ –ø–æ–¥–¥–æ–º–µ–Ω)

```bash
yc storage bucket update --name ai-photos \
  --cors "[{\"allowed_origins\":[\"https://cdn.photobot.ai\"],\"allowed_methods\":[\"GET\"]}]"
```

#### –®–∞–≥ 6. –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—ã–µ URL (–ø—Ä–∏–≤–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø)

```python
import boto3, datetime, os
s3 = boto3.client('s3',
    endpoint_url='https://storage.yandexcloud.net',
    aws_access_key_id=os.getenv('AWS_ACCESS_KEY_ID'),
    aws_secret_access_key=os.getenv('AWS_SECRET_ACCESS_KEY'))
url = s3.generate_presigned_url('get_object',
    Params={'Bucket':'ai-photos', 'Key':'out/001.jpg'},
    ExpiresIn=30*24*3600)  # 30 –¥–Ω–µ–π
```

#### –®–∞–≥ 7. –ü—Ä–∞–≤–∏–ª–æ –∞–≤—Ç–æ‚Äë–æ—á–∏—Å—Ç–∫–∏ (lifecycle)

–£–¥–∞–ª—è–µ–º –∏—Å—Ö–æ–¥–Ω—ã–µ —Å–µ–ª—Ñ–∏ —á–µ—Ä–µ–∑ 30 –¥–Ω–µ–π:

```bash
yc storage lifecycle-rule create --bucket ai-photos \
  --enabled true \
  --expiration-days 30 \
  --filter prefix="raw/"
```

### 17.4 –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞

```bash
mc alias set yc https://storage.yandexcloud.net $AWS_ACCESS_KEY_ID $AWS_SECRET_ACCESS_KEY
mc ls yc/ai-photos
```

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ ‚Äî –¥–æ—Å—Ç—É–ø –µ—Å—Ç—å, –±–∞–∫–µ—Ç –ø—Ä–∏–≤–∞—Ç–Ω—ã–π.

---

> –¢–µ–ø–µ—Ä—å –±–æ—Ç, –≤–æ—Ä–∫–µ—Ä –∏ `delivery_fn` –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –∫–ª—é—á–∏ SA –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏/—Å–∫–∞—á–∏–≤–∞–Ω–∏—è; –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö free‚Äëtier (1 GB storage + 100 GB –∏—Å—Ö–æ–¥—è—â–µ–≥–æ CDN‚Äë—Ç—Ä–∞—Ñ–∏–∫–∞ –≤ –º–µ—Å—è—Ü).

## 18. –û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è –æ–±–ª–∞—á–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (v2 ‚Äî –∏—é–ª—å 2025) üÜï

### 18.1 –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

| –ë—ã–ª–æ (v1)                                                                             | –°—Ç–∞–ª–æ (v2)                                                                    |
| ------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------- |
| `docker-compose` —Å 5+ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏: bot, image_worker, redis, openai‚Äëproxy, postgres | **–¢–æ–ª—å–∫–æ –¥–≤–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞** (bot, worker) ‚Üí –¥–µ–ø–ª–æ–∏–º –∫–∞–∫ *Serverless Containers* |
| –õ–æ–∫–∞–ª—å–Ω—ã–π Redis –¥–ª—è –æ—á–µ—Ä–µ–¥–∏                                                           | **Yandex Message Queue** (managed)                                            |
| –ü—Ä–æ–∫—Å–∏ –∫ OpenAI/PiAPI                                                                 | **—É–±—Ä–∞–Ω** ‚Äî –±–æ—Ç –∏ –≤–æ—Ä–∫–µ—Ä —Å—Ç—É—á–∞—Ç—Å—è –∫ PiAPI –Ω–∞–ø—Ä—è–º—É—é –ø–æ HTTPS                   |
| Postgres (–Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è)                                                           | **—É–±—Ä–∞–Ω**                                                                     |
| –û–±—â–∏–π S3 bucket + –ø—É–±–ª–∏—á–Ω—ã–µ ACL                                                       | S3 –æ—Å—Ç–∞—ë—Ç—Å—è, ACL –ø—Ä–∏–≤–∞—Ç–Ω—ã–π, –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ URL                      |

### 18.2 –ù–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞

```mermaid
flowchart LR
    subgraph YC
        TG(Telegram Bot 
 Serverless Container)
        W(Celery Worker 
 Serverless Container)
        MQ(Yandex Message Queue)
        S3((Object Storage))
    end
    User-->TG
    TG-->|publish `jobs`|MQ
    W-->|consume|MQ
    W-->|upload JPG/ZIP|S3
    TG-->|signed URL / ZIP|User
```

### 18.3 –ü–æ—à–∞–≥–æ–≤—ã–π –ø–µ—Ä–µ—Ö–æ–¥

1. **docker-compose –ª–æ–∫–∞–ª—å–Ω–æ**: –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ `telegram-bot` –∏ `image-worker` services.
2. **–†–∞–∑–¥–µ–ª—è–µ–º Dockerfile**: `Dockerfile.bot`, `Dockerfile.worker` (multi‚Äëstage slim‚Äëpython 3.11).
3. **YC deployment**

   ```bash
   yc container registry create photostudio-reg
   yc serverless container create --name photobot --runtime docker --folder-id $FOLDER_ID \
        --image cr.yandex/<...>/photobot:latest --memory 512M --cores 1 \
        --service-account-id $SA_ID --environment "MQ_URL=https://message-queue.api.cloud.yandex.net/..."
   yc serverless container create --name ai-worker --runtime docker --folder-id $FOLDER_ID \
        --image cr.yandex/<...>/ai-worker:latest --memory 1G --cores 2 \
        --service-account-id $SA_ID --environment "MQ_URL=..."
   ```
4. **–û—á–µ—Ä–µ–¥—å**: `yc message-queue queue create --name jobs --fifo=true --visibility-timeout 30`.
5. **–ó–∞–º–µ–Ω–∞ Redis URL –≤ –∫–æ–¥–µ**: `REDIS_URL` ‚Üí `MQ_QUEUE_URL` (–ø—Ä–∏–º–µ—Ä –≤ `settings.py`).
6. **CI**: –≤ GitHub Actions –¥–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö deploy‚Äëjob: `build-bot` –∏ `build-worker`.

### 18.4 –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –ª–æ–≥–∏–∫–µ üóíÔ∏è

* –¢–µ–ø–µ—Ä—å –±–æ—Ç –Ω–µ –¥–µ—Ä–∂–∏—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis; –ø—É–±–ª–∏–∫—É–µ—Ç –∑–∞–¥–∞–Ω–∏—è —á–µ—Ä–µ–∑ HTTP‚ÄëSDK MQ ‚Üí —ç–∫–æ–Ω–æ–º–∏—è RAM –∏ –ø–æ—Ä—Ç–æ–≤.
* Worker –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è Serverless‚Äë–ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π –ø–æ –º–µ—Ç—Ä–∏–∫–µ `ApproximateNumberOfMessagesVisible` –≤ –æ—á–µ—Ä–µ–¥–∏.
* –ü—Ä–æ–∫—Å–∏ –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω: —É PiAPI –Ω–µ—Ç IP‚Äë–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, –ø–æ—ç—Ç–æ–º—É –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã —É–ø—Ä–æ—â–∞—é—Ç —Å—Ö–µ–º—É.

> **–í–∞–∂–Ω–æ:** —Ä–∞–∑–¥–µ–ª—ã 12 (Automation Blueprint) –∏ 13 (Telegram Delivery) **–æ—Å—Ç–∞—é—Ç—Å—è –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏**, –º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –æ—á–µ—Ä–µ–¥–∏. –û—Å—Ç–∞–≤—à–∏–π—Å—è compose –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏—à—å –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ CI‚Äë—Ç–µ—Å—Ç–æ–≤.

## 19. –¶–µ–Ω–æ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∏ –≤–æ—Å—Ç—Ä–µ–±–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ (–∏—é–ª—å 2025) üÜï

### 19.1 –õ–∏–Ω–µ–π–∫–∞ –ø–∞–∫–µ—Ç–æ–≤

| –ü–∞–∫–µ—Ç        | –ö–æ–ª-–≤–æ —Ñ–æ—Ç–æ / –æ–±—Ä–∞–∑–æ–≤                                            | –ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç                              | –í—Ä–µ–º—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ | –¶–µ–Ω–∞, ‚ÇΩ           | –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å\* | –¶–ê                                 |
| ------------ | ---------------------------------------------------------------- | ----------------------------------------- | ---------------- | ----------------- | --------------- | ---------------------------------- |
| **–ü—Ä–æ–±–Ω—ã–π**  | 2 —Ñ–æ—Ç–æ, 1 –æ–±—Ä–∞–∑                                                  | –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (watermark OFF)      | < 1 —á            | **0** (–∏–ª–∏ 100 ‚ÇΩ) | 4 ‚ÇΩ             | –í—Å–µ –Ω–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –ª–∏–¥-–º–∞–≥–Ω–∏—Ç |
| **–ë–∞–∑–æ–≤—ã–π**  | 10 —Ñ–æ—Ç–æ, 3 –æ–±—Ä–∞–∑–∞                                                | web‚Äë–∫–∞—á–µ—Å—Ç–≤–æ, 1920 px, —Ñ–∏–ª—å—Ç—Ä –¥–µ—Ñ–µ–∫—Ç–æ–≤    | 6 —á              | **1 500 ‚ÇΩ**       | 75 ‚ÇΩ            | –ú–∞—Å—Å–æ–≤—ã–π —Å–µ–≥–º–µ–Ω—Ç —Å–æ—Ü—Å–µ—Ç–µ–π          |
| **–°—Ç–∞–Ω–¥–∞—Ä—Ç** | 25 —Ñ–æ—Ç–æ, 5 –æ–±—Ä–∞–∑–æ–≤ + 1 short‚Äëvideo                               | HQ (3 K), –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –æ—á–µ—Ä–µ–¥—å            | 24 —á             | **3 500 ‚ÇΩ**       | 210 ‚ÇΩ           | –ë–ª–æ–≥–µ—Ä—ã, –∫–æ—Å–ø–ª–µ–π, –¥–µ–π—Ç–∏–Ω–≥          |
| **–ü—Ä–µ–º–∏—É–º**  | 50 —Ñ–æ—Ç–æ, 8 –æ–±—Ä–∞–∑–æ–≤, 2 –≤–∏–¥–µ–æ, 4K‚Äë–∞–ø—Å–∫–µ–π–ª + —Ä—É—á–Ω–∞—è —Ä–µ—Ç—É—à—å 5 –ª—É—á—à–∏—Ö | –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä, –ø—Ä–∞–≤–∞ –Ω–∞ –∫–æ–º–º–µ—Ä—Ü–∏—é | 48 —á             | **8 990 ‚ÇΩ**       | 470 ‚ÇΩ           | –ú–∞–ª—ã–π –±–∏–∑–Ω–µ—Å, –ø–æ–¥–∞—Ä–æ—á–Ω—ã–µ –∑–∞–∫–∞–∑—ã    |

\*–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞ –∏–∑ PiAPI \$0.02/–∏–∑–æ–±—Ä. + GPT‚Äë4o prompt \$0.00036 + WanX video \$0.28 + Object Storage (0.3 GB) –≤ —Ä—É–±–ª—è—Ö –ø–æ –∫—É—Ä—Å—É 90 ‚ÇΩ/\$.

**–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è —Ü–µ–Ω:**

* –ß–µ–∫ ‚â§ 1 500 ‚ÇΩ ‚Äî ¬´–∏–º–ø—É–ª—å—Å–Ω–∞—è –ø–æ–∫—É–ø–∫–∞¬ª (‚âà –æ–¥–∏–Ω –ø–æ—Ö–æ–¥ –≤ –∫–∏–Ω–æ).
* 3‚Äì4 —Ç—ã—Å. ‚ÇΩ ‚Äî ¬´—Ä–∞–∑—É–º–Ω–∞—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è¬ª –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç‚Äë–∫—Ä–µ–∞—Ç–æ—Ä–æ–≤.
* 8 —Ç—ã—Å.+ ‚Äî –Ω–∏—à–µ–≤–æ–π –ø—Ä–µ–º–∏—É–º, –≥–¥–µ –∫–ª–∏–µ–Ω—Ç –∂–¥—ë—Ç —ç–∫—Å–∫–ª—é–∑–∏–≤ –∏ —Ä—É—á–Ω—É—é –¥–æ—Ä–∞–±–æ—Ç–∫—É.

> –ë–∞–∑–æ–≤—ã–π –ø–∞–∫–µ—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–∫—Ä—ã–≤–∞—Ç—å ‚â• 60 % –ø—Ä–æ–¥–∞–∂, –°—Ç–∞–Ω–¥–∞—Ä—Ç ‚Äî 30 %, –ü—Ä–µ–º–∏—É–º ‚Äî 10 % (–Ω–æ –¥–∞—ë—Ç ‚âà 30 % –≤—ã—Ä—É—á–∫–∏). –ü—Ä–æ–±–Ω—ã–π ‚Äî –ª–∏–¥‚Äë–º–∞–≥–Ω–∏—Ç, –∫–æ–Ω–≤–µ—Ä—Å–∏—è –≤ –ø–æ–∫—É–ø–∫—É —Ü–µ–ª–µ–≤—ã—Ö –ø–∞–∫–µ—Ç–æ–≤ \~15 %.

### 19.2 –°–∞–º—ã–µ –≤–æ—Å—Ç—Ä–µ–±–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ (Telegram‚Äë–æ–ø—Ä–æ—Å—ã –∏ –º–µ—Ç—Ä–∏–∫–∏ Facee & Luxonika)

| –ö–æ–¥        | –ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∏–ª—è         | –û–ø–∏—Å–∞–Ω–∏–µ / –ø—Ä–æ–º—Ç‚Äë—è–∫–æ—Ä—å                                             | –ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å\*\* |
| ---------- | ---------------------- | ------------------------------------------------------------------ | ---------------- |
| **RL-01**  | Realistic Studio Vogue | ¬´cinematic studio portrait, softbox light, pastel backdrop¬ª        | ‚≠ê‚≠ê‚≠ê‚≠ê‚ú∞            |
| **FN-02**  | Fantasy Ethereal       | ¬´fairy forest, glowing particles, pastel haze, whimsical¬ª          | ‚≠ê‚≠ê‚≠ê‚≠ê‚ú∞            |
| **CP-03**  | Cyberpunk Neon City    | ¬´rainy neon streets, backlit, teal‚Äëmagenta glow¬ª                   | ‚≠ê‚≠ê‚≠ê‚ú∞‚ú∞            |
| **MJ6-04** | Midjourney V6 Look     | `lora_type:"mjv6", lora_strength:0.8` ‚Äî –≥–ª—è–Ω—Ü–µ–≤–∞—è –∏–ª–ª—é—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ—Å—Ç—å | ‚≠ê‚≠ê‚≠ê‚ú∞‚ú∞            |
| **CEO-05** | Corporate Headshot     | ¬´dark grey backdrop, rim light, Leica 90 mm Summicron¬ª             | ‚≠ê‚≠ê‚≠ê‚≠ê‚ú∞            |
| **PST-06** | Pastel Dream           | ¬´soft diffused light, Fujifilm Pro 400H, blossoms¬ª                 | ‚≠ê‚≠ê‚≠ê‚ú∞‚ú∞            |
| **CLS-07** | Classic B&W           | ¬´high‚Äëcontrast, Hasselblad, Ilford HP5¬ª                            | ‚≠ê‚≠ê‚≠ê‚ú∞‚ú∞            |
| **CSP-08** | Cosplay Hero           | ¬´anime hero armor, dynamic pose, dramatic lighting¬ª                | ‚≠ê‚≠ê‚≠ê‚ú∞‚ú∞            |

\*\*–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å\*\* ‚Äî —É—Å—Ä–µ–¥–Ω—ë–Ω–Ω–æ–µ —á–∏—Å–ª–æ –∑–∞–∫–∞–∑–æ–≤/100 –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ –¥–∞–Ω–Ω—ã–º –æ–ø—Ä–æ—Å–æ–≤ –≤ —Ç–µ–º–∞—Ç. –∫–∞–Ω–∞–ª–∞—Ö (06‚Äì07 2025).

### 19.3 –ö–∞–∫ –ø—Ä–∏–º–µ–Ω—è—Ç—å —Å—Ç–∏–ª–∏ –≤ –±—Ä–∏—Ñ–µ –±–æ—Ç–∞

1. –ù–∞ —à–∞–≥–µ ¬´–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∏–ª—å¬ª –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å 6 —Å–∞–º—ã—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö (RL‚Äë01 ‚Ä¶ CLS‚Äë07) + –∫–Ω–æ–ø–∫—É ¬´–î—Ä—É–≥–æ–π¬ª ‚áí –≤–≤–æ–¥ —Å–≤–æ–±–æ–¥–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º.
2. –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —Å—Ç–∏–ª—å —Å LoRA (MJ6‚Äë04), –±—ç–∫‚Äë–µ–Ω–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç `"lora_settings"`.
3. –î–ª—è –ø—Ä–µ–º–∏—É–º‚Äë–ø–∞–∫–µ—Ç–∞ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å **mix‚Äëmode**: –¥–æ 2 —Å—Ç–∏–ª–µ–π –Ω–∞ –æ–¥–∏–Ω –æ–±—Ä–∞–∑ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Realistic + Cyberpunk Edge).

---

> **–ù–æ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞:** —Ñ–æ–∫—É—Å –Ω–∞ –º–∞—Å—Å–æ–≤—ã–π ¬´–ë–∞–∑–æ–≤—ã–π¬ª 1 500 ‚ÇΩ, upsell –¥–æ 3 500 ‚ÇΩ –∑–∞ –≤–∏–¥–µ–æ –∏ 8 990 ‚ÇΩ –∑–∞ —Ä–µ—Ç—É—à—å. –°—Ç–∏–ª–∏ –≤—ã–±—Ä–∞–Ω—ã –ø–æ —Ä–µ–∞–ª—å–Ω–æ–π –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏ –≤ –†—É–Ω–µ—Ç–µ; –¥–æ–±–∞–≤—å—Ç–µ –∏—Ö –≤ —à–∞–≥ 4 –±—Ä–∏—Ñ–∞ –∏ –ø—Ä–æ–º–æ‚Äë–º–∞—Ç–µ—Ä–∏–∞–ª—ã.

## 20. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Å—Ç‚Äë–ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–µ–º–∏—É–º‚Äë–ø–∞–∫–µ—Ç–∞ üÜï

### 20.1 –ü–æ—Ç–æ–∫ –±–µ–∑ —Ä—É—á–Ω–æ–π —Ä–µ—Ç—É—à–∏

```mermaid
flowchart TD
    A(Flux/GPT render) --> B(Post‚Äëproc queue)
    B --> C[Face & NSFW check]
    C -->|OK| D[GFPGAN / CodeFormer restore]
    C -->|NSFW| X[discard]
    D --> E[Inpaint if defect]
    E --> F[Color & CLAHE]
    F --> G[Real‚ÄëESRGAN 4√ó]
    G --> H[S3 upload]
```

* **Face + NSFW:** PiAPI `hume-nsfw` (skip –µ—Å–ª–∏ score < 0.7).
* **Restore:** Python lib `codeformer` (`strength=0.7`).
* **Inpaint:** PiAPI `stable-diffusion-inpaint` —Å mask auto‚Äëdetect.
* **Color:** `magick autolevel && magick clahe 8x8`.
* **Upscale:** `realesrgan-ncnn-vulkan -n realesrgan-x4plus`.
* –û–±—â–∏–π runtime ‚âà 4 —Å/–∫–∞–¥—Ä –Ω–∞ vCPU‚ÄëC3, RAM < 700 MB.

### 20.2 Celery —Ç–∞—Å–∫–∏ (–ø—Ä–∏–º–µ—Ä)

```python
@app.task
def post_proc(path: str):
    img = cv2.imread(path)
    # 1. NSFW filter
    if nsfw_score(img) > 0.7:
        raise Reject("NSFW")
    # 2. Restore face
    restored = codeformer_restore(img, strength=0.7)
    # 3. Detect defects (extra fingers, holes)
    if defect_detect(restored):
        restored = inpaint_defects(restored)
    # 4. Color/contrast fix
    restored = autolevel_clahe(restored)
    # 5. 4K upscale (premium only)
    if current_package()=="premium":
        restored = realesrgan_upscale(restored)
    cv2.imwrite(path, restored, [cv2.IMWRITE_JPEG_QUALITY,95])
    return path
```

### 20.3 –í—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≤ blueprint (—Ä–∞–∑–¥–µ–ª 12)

| –®–∞–≥ | Trigger                 | Task                    | Queue      |
| --- | ----------------------- | ----------------------- | ---------- |
| 4a  | `render_done` (Premium) | `post_proc.delay(path)` | `postproc` |
| 4b  | `post_proc_done`        | upload to S3            | `default`  |

*–î–ª—è –ë–∞–∑–æ–≤—ã–π/–°—Ç–∞–Ω–¥–∞—Ä—Ç –≤—ã–ø–æ–ª–Ω—è–µ–º —Ç–æ–ª—å–∫–æ `nsfw_score`. –ü—Ä–µ–º–∏—É–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞–µ—Ç postproc + upscale.*

### 20.4 –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å extra‚Äë–ø—Ä–æ—Ü–µ—Å—Å–∞ (50 —Ñ–æ—Ç–æ)

| –®–∞–≥                 | CPU‚Äë—Å–µ–∫  | API \$                 | –ò—Ç–æ–≥–æ ‚ÇΩ |
| ------------------- | -------- | ---------------------- | ------- |
| CodeFormer √ó50      | 30 —Å     | ‚Äì                      | 0       |
| Inpaint 10 % –∏–∑–æ–±—Ä. | ‚Äì        | \$0.002√ó5 = **\$0.01** | 0.9 ‚ÇΩ   |
| Real‚ÄëESRGAN √ó50     | 55 —Å     | ‚Äì                      | 0       |
| **–í—Å–µ–≥–æ**           | 85 —Å CPU | \$0.01                 | \~1 ‚ÇΩ   |

### 20.5 Fallback ¬´—Ä—É—á–Ω–∞—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞¬ª (–ø–æ –∑–∞–ø—Ä–æ—Å—É)

1. –ö–ª–∏–µ–Ω—Ç –Ω–∞–∂–∏–º–∞–µ—Ç ¬´‚ö† –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ #12¬ª.
2. –ë–æ—Ç –∫–ª–∞–¥—ë—Ç `manual_fix` –≤ –æ—á–µ—Ä–µ–¥—å.
3. –¢–µ–ª–µ–≥—Ä–∞–º‚Äë–±–æ—Ç —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∞ –ø–æ–ª—É—á–∞–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ S3, —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç, –∑–∞–≥—Ä—É–∂–∞–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ.
4. `delivery_fn` –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∫–µ.

> –¢—Ä—É–¥ —Ä—É—á–Ω–æ–π —Ä–µ—Ç—É—à–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–∂–µ 5 % —Å–ª—É—á–∞–µ–≤; —Å–∏—Å—Ç–µ–º–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –¥–ª—è 95 % –∑–∞–∫–∞–∑–æ–≤.

## 21. Short‚Äëvideo –¥–ª—è –ø–∞–∫–µ—Ç–∞ ¬´–°—Ç–∞–Ω–¥–∞—Ä—Ç¬ª üÜï

### 21.1 –î–µ—Ñ–æ–ª—Ç: WanX `img2video-14b-lora`

| –ü–∞—Ä–∞–º–µ—Ç—Ä            | –ó–Ω–∞—á–µ–Ω–∏–µ                                                                         |
| ------------------- | ------------------------------------------------------------------------------- |
| **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**    | 4 ‚Äì 6 —Å, 720 p, 20 fps                                                          |
| **API‚Äë—ç–Ω–¥–ø–æ–∏–Ω—Ç**    | `model:"Qubico/wanx", task_type:"img2video-14b-lora"`                           |
| **–°—Ç–æ–∏–º–æ—Å—Ç—å**       | \$0.28 ‚âà 25 ‚ÇΩ –∑–∞ —Ä–æ–ª–∏–∫                                                          |
| **–í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏** | 20‚Äì30 —Å                                                                         |
| **LoRA**            | `lora_settings ‚Üí lora_type` –Ω–∞—Å–ª–µ–¥—É–µ—Ç —Å—Ç–∏–ª—å (RL‚Äë01 ‚Üí realism, MJ6‚Äë04 ‚Üí mjv6, ‚Ä¶) |

```python
async def make_short_video(img_url: str, style: str):
    payload = {
        "model": "Qubico/wanx",
        "task_type": "img2video-14b-lora",
        "input": {
            "init_image": img_url,
            "prompt": f"{style} dynamic head‚Äëturn, cinematic rim light",
            "lora_settings": {
                "lora_type": style_code(style),
                "lora_strength": 0.7
            },
            "fps": 20,
            "max_seconds": 6
        }
    }
    task_id = piapi_create(payload)
    return wait_video_url(task_id)  # S3 link
```

*–ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —á–µ—Ä–µ–∑ **`sendVideo`** + inline‚Äë–∫–Ω–æ–ø–∫—É ¬´üì• –°–∫–∞—á–∞—Ç—å 720 p¬ª.*

### 21.2 –ê–ø—Å–µ–π–ª ¬´Long Story¬ª

| –ü–∞—Ä–∞–º–µ—Ç—Ä            | –ó–Ω–∞—á–µ–Ω–∏–µ                                    |
| ------------------- | ------------------------------------------- |
| **API**             | `Qubico/framepack`, `task_type:"img2video"` |
| **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**    | 10 ‚Äì 20 —Å, 720 p, 15 fps                    |
| **–°—Ç–æ–∏–º–æ—Å—Ç—å**       | \$0.03 √ó —Å–µ–∫ (10 —Å ‚âà 27 ‚ÇΩ)                  |
| **–î–æ–ø–ª–∞—Ç–∞ –∫–ª–∏–µ–Ω—Ç—É** | +900 ‚ÇΩ –∫ –ø–∞–∫–µ—Ç—É                             |
| **–û—á–µ—Ä–µ–¥—å**         | `video_long` (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è 2‚Äì4 –º–∏–Ω)            |

### 21.3 –í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ –≤ blueprint

| –ü–∞–∫–µ—Ç    | Queue        | Task                                        |
| -------- | ------------ | ------------------------------------------- |
| –°—Ç–∞–Ω–¥–∞—Ä—Ç | `video`      | `make_short_video(best_img, style)`         |
| –ü—Ä–µ–º–∏—É–º  | `video_long` | `make_long_video(best_img, style, seconds)` |

> –≠—Ç–æ –¥–æ–ø–æ–ª–Ω—è–µ—Ç —Ä–∞–∑–¥–µ–ª 12: –¥–ª—è –ø–∞–∫–µ—Ç–∞ ¬´–°—Ç–∞–Ω–¥–∞—Ä—Ç¬ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è WanX‚Äëvideo, –¥–ª—è ¬´–ü—Ä–µ–º–∏—É–º¬ª –ø–æ –∑–∞–ø—Ä–æ—Å—É –∫–ª–∏–µ–Ω—Ç–∞ ‚Äî Framepack‚Äë—Ä–æ–ª–∏–∫. –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–æ–ª–∏–∫–∞ —É–∂–µ —É—á—Ç–µ–Ω–∞ –≤ —Ü–µ–Ω–µ 3 500 ‚ÇΩ (—Ä–∞–∑–¥–µ–ª 19).

---

> **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ–±—â–∏–º pipeline:** –†–∞–∑–¥–µ–ª 21 –¥–æ–ø–æ–ª–Ω—è–µ—Ç Blueprint –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ 12, –¥–æ–±–∞–≤–ª—è—è –≤–∏–¥–µ–æ-–æ–±—Ä–∞–±–æ—Ç–∫—É –¥–ª—è –ø–∞–∫–µ—Ç–æ–≤ "–°—Ç–∞–Ω–¥–∞—Ä—Ç" –∏ "–ü—Ä–µ–º–∏—É–º".
